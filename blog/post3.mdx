---
title: "Tailwind, React et le Dark mode"
date: "2022-10-06"
slug: "tailwind-react-darkmode"
---
## La base

Pour activer le dark mode sur tailwind il y a deux m√©thodes : le media et la classe. Mais avant de rentrer dans les d√©tails, parlons de tailwind.

Je suis tomb√© amoureux de ce frameworks CSS car il est d‚Äôune simplicit√© incroyable. √Ä premi√®re vu √ßa semble incompr√©hensible d‚Äô√©crire du html avec des classes a rallonge type `class=" w-80 flex justify-center items-center border rounded-lg bg-slate-400 text-slate-50"` mais rien qu‚Äôen lisant √ßa vous avez surement du vous imaginer les effets possibles. Et le mieux c‚Äôest quand on rentre dans les interactions  

On entre alors sur de la simplicit√© pur : `class=" text-black bg-white hover:text-white hover:bg-white"`. Et il en va de m√™me avec le darkmode ou il nous suffit de sp√©cifier `dark:text-white dark:bg-black`.

## Dark Mode

Maintenant, selon la doc tailwind, pour impl√©menter ce fameux th√®me sombre on peut indiquer dans notre tailwind.config.js comment va √™tre g√©rer notre *pseudo-classe* `dark:` : 

### Le mode ‚Äòmedia‚Äô

```json
/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: 'media', // <= Ici en media
  content: [
    "./src/pages/**/*.{js,jsx,ts,tsx}",
    "./src/components/**/*.{js,jsx,ts,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}
```

Je ne l‚Äôai pas encore utiliser et pourtant je devrais peut √™tre car au final c‚Äôest notre site qui va r√©cup√©rer l‚Äôinfo pour savoir sous quel th√®me se situe l‚Äôutilisateur. C‚Äôest comme le mode syst√®me pour notre site. On √† juste √† dire √† tailwind de s‚Äôadapter √† la configuration de l‚Äôutilisateur.

### Le mode ‚Äòclass‚Äô

```json
/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: 'class', // <= Ici en class
  content: [
    "./src/pages/**/*.{js,jsx,ts,tsx}",
    "./src/components/**/*.{js,jsx,ts,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}
```

C‚Äôest l√† que √ßa devient plus tricky. Car on indique que tailwind doit regarder si la balise html du site a la classe ‚Äòdark‚Äô. On va adapter le code qui est fourni dans la doc tailwind :

```jsx
// On page load or when changing themes, best to add inline in `head` to avoid FOUC
if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
  document.documentElement.classList.add('dark') 
} else {
  document.documentElement.classList.remove('dark')
}

// Whenever the user explicitly chooses light mode :  Quand notre user clique sur le petit soleil 
localStorage.theme = 'light'

// Whenever the user explicitly chooses dark mode :  et la quand il clique sur la lune
localStorage.theme = 'dark'

// Whenever the user explicitly chooses to respect the OS preference
localStorage.removeItem('theme')
```

Jusqu‚Äôici rien de tr√®s compliqu√©, on cr√©e un bouton avec un soleil ou lune qui vont changer √† chaque clique et ajouter ou supprimer la classe ‚Äòdark‚Äô √† notre balise html. Et je me suis dis que j‚Äôallais jouer avec √ßa sur chacun de mes sites pour ajouter cette touche ‚Äúpro‚Äù. Mais c‚Äô√©tait sans faire attention √† la logique derri√®re React‚Ä¶

## React et le darkmode

Et c‚Äôest en me confrontant au probl√®me de ‚Äúj‚Äôai pas de balise html dans mon code‚Äù ou encore ‚Äúmais du coup je mets o√π mon code tailwind et mon switch ?? üò¢.

Alors j‚Äôai fait comme tout professionnel d√©butant ‚Ä¶ ‚áí Youtube. Et comme l‚Äôastuce marche bien (comme on peut le voir sur ce site), je me suis dit que j‚Äôallais en faire un article pour retrouver √† chaque fois mon petit raccourci.

### Step 1 : cr√©er un hook.

C‚Äôest plut√¥t cool d‚Äôailleurs car c‚Äôest en faisant des recherches sur comment ajouter ce fameux dark mode que je me suis pench√© un peu plus sur les hooks de React. Je ferais un autre article dessus pour r√©sumer tout ce que j‚Äôai compris. Ici, on doit utiliser deux hooks :

- useState() en lui indiquant light ou dark : `const [theme, setTheme] = useState(checkout);` // Alors oui, checkout c‚Äôest parce que si je me base sur le localStorage de mon user pour d√©finir le premier state √ßa m‚Äôaffiche une erreur SSR dans mon serveur local car l‚Äô√©l√©ment `window` n‚Äôest pas d√©fini. Donc j‚Äôajoute une constante `const checkout = typeof window !== 'undefined' ? localStorage.getItem('theme') : 'dark'` et je lui dit ‚áí soit window est d√©fini donc on prend le theme du user soit par d√©faut on affiche le theme dark.
- useEffect() car on va mettre √† jour le DOM √† chaque fois que notre useState() change. C‚Äôest-√†-dire ajouter ou enlever la class ‚Äúdark‚Äù √† notre balise html.

```jsx
import { useState } from "react";
import { useEffect } from "react";

export default function useDarkMode() {
    const checkout = typeof window !== 'undefined' ? localStorage.getItem('theme') : 'dark'
    const [theme, setTheme] = useState(checkout);
    const colorTheme = theme === 'dark' ? 'light' : 'dark';
    useEffect(() => {
        const html = document.documentElement;

        html.classList.remove(colorTheme);
        html.classList.add(theme);  
        localStorage.setItem("theme", theme);
    }, [theme, colorTheme])

    return [colorTheme, setTheme];
}
```

### Step 2 : Cr√©er notre bouton

```jsx
import * as React from 'react'
// import { useEffect } from 'react'
import useDarkMode from '../hook/useDarkMode'

export default function ThemeToggle() {
    const [colorTheme, setTheme] = useDarkMode();

    return (
        <div>
            <button onClick={() => setTheme(colorTheme)} className="transition duration-500">
                {
                    colorTheme === 'light' 
                    
                    ? 
                    // Ce qui va s'afficher en Dark
                    (<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-8 h-8">
                        <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z" />
                    </svg>)

                    :
                    // Ce qui va s'afficher en light mode
                    (<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-7 h-7 rotate-[225deg]">
                        <path fillRule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z" clipRule="evenodd" />
                    </svg> )
                }
            </button>
            
        </div>
    )
}
```

Ici c‚Äôest plus simple. On appelle notre hook et en fonction de ce que renvoie colorTheme on affiche un soleil ou une lune. Quand on appuie sur le bouton on dit √† setTheme de changer en fonction de la valeur pr√©c√©dente de colorTheme.

## Conclusion

Voil√† ma version du toggle Dark Mode avec tailwind et React. Simple et r√©utilisable, j‚Äôessaierai de l‚Äôadapter avec un vrai bouton switch qui est disponible dans le package @headlessui des cr√©ateurs de tailwind.